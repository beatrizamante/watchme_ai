Configuration Guide
===================

This guide covers the configuration options for the WatchMe AI Backend, including environment variables, model settings, and deployment configurations.

Environment Variables
---------------------

The WatchMe AI Backend uses environment variables for configuration management. Create a ``.env`` file in your project root with the following settings:

Core Configuration
~~~~~~~~~~~~~~~~~~

.. code-block:: bash

   # Basic server configuration
   HOST=0.0.0.0
   PORT=5000
   DEBUG=false

   # Security
   ENCRYPTION_KEY=your_base64_encryption_key_here

AI Model Configuration
~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: bash

   # YOLO Configuration
   YOLO_MODEL_PATH=src/infrastructure/yolo/client/best.pt
   YOLO_PROJECT_PATH=src/infrastructure/yolo/projects
   YOLO_DATASET_PATH=src/dataset/yolo
   YOLO_CONFIDENCE_THRESHOLD=0.5
   YOLO_IOU_THRESHOLD=0.45

   # OSNet Configuration
   OSNET_SAVE_DIR=src/infrastructure/osnet/client
   OSNET_DATASET_PATH=src/dataset/osnet
   OSNET_NUM_CLASSES=751
   OSNET_EPOCHS=100
   OSNET_BATCH_SIZE=32
   OSNET_LEARNING_RATE=0.00035

Performance Settings
~~~~~~~~~~~~~~~~~~~~

.. code-block:: bash

   # GPU Configuration
   CUDA_VISIBLE_DEVICES=0
   USE_GPU=true

   # Processing Limits
   MAX_VIDEO_SIZE_MB=500
   MAX_IMAGE_SIZE_MB=50
   FRAME_PROCESSING_LIMIT=10
   WEBSOCKET_TIMEOUT=300

Generating Encryption Key
-------------------------

The encryption key is used to secure person embeddings. Generate a secure key:

.. code-block:: python

   import base64
   import secrets

   # Generate a 256-bit key
   key = secrets.token_bytes(32)
   key_b64 = base64.b64encode(key).decode()
   print(f"ENCRYPTION_KEY={key_b64}")

Model Configuration
-------------------

YOLO Settings
~~~~~~~~~~~~~

Configure YOLO object detection:

.. code-block:: python

   # In config.py
   class YOLOSettings(BaseSettings):
       YOLO_MODEL_PATH: str = "src/infrastructure/yolo/client/best.pt"
       YOLO_CONFIDENCE_THRESHOLD: float = 0.5
       YOLO_IOU_THRESHOLD: float = 0.45
       YOLO_PROJECT_PATH: str = "src/infrastructure/yolo/projects"

OSNet Settings
~~~~~~~~~~~~~~

Configure OSNet person re-identification:

.. code-block:: python

   # In config.py
   class OSNetSettings(BaseSettings):
       OSNET_SAVE_DIR: str = "src/infrastructure/osnet/client"
       OSNET_NUM_CLASSES: int = 751
       OSNET_EPOCHS: int = 100
       OSNET_BATCH_SIZE: int = 32

Deployment Configuration
-------------------------

Development Environment
~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: bash

   # .env.development
   DEBUG=true
   HOST=localhost
   PORT=5000
   LOG_LEVEL=DEBUG

Production Environment
~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: bash

   # .env.production
   DEBUG=false
   HOST=0.0.0.0
   PORT=443
   LOG_LEVEL=INFO
   USE_HTTPS=true
   SSL_CERT_PATH=/path/to/cert.pem
   SSL_KEY_PATH=/path/to/key.pem

Docker Configuration
~~~~~~~~~~~~~~~~~~~~

Example ``docker-compose.yml``:

.. code-block:: yaml

   version: '3.8'
   services:
     watchme-ai:
       build: .
       ports:
         - "5000:5000"
       environment:
         - HOST=0.0.0.0
         - PORT=5000
       volumes:
         - ./models:/app/models
         - ./datasets:/app/datasets
       deploy:
         resources:
           reservations:
             devices:
               - driver: nvidia
                 count: 1
                 capabilities: [gpu]

Logging Configuration
---------------------

Configure logging levels and outputs:

.. code-block:: python

   import logging

   # Basic logging setup
   logging.basicConfig(
       level=logging.INFO,
       format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
       handlers=[
           logging.FileHandler('watchme_ai.log'),
           logging.StreamHandler()
       ]
   )

Advanced Configuration
----------------------

Custom Model Paths
~~~~~~~~~~~~~~~~~~~

For custom trained models:

.. code-block:: bash

   # Custom YOLO model
   YOLO_MODEL_PATH=/path/to/your/custom_yolo.pt

   # Custom OSNet checkpoint
   OSNET_CHECKPOINT_PATH=/path/to/your/osnet_checkpoint.pth.tar

Database Integration
~~~~~~~~~~~~~~~~~~~~

If integrating with external databases:

.. code-block:: bash

   # Database configuration
   DATABASE_URL=postgresql://user:password@localhost:5432/watchme
   REDIS_URL=redis://localhost:6379/0

API Integration
~~~~~~~~~~~~~~~

Configuration for external API integration:

.. code-block:: bash

   # External API endpoints
   WATCHME_API_URL=http://localhost:3000
   API_KEY=your_api_key_here
   WEBHOOK_SECRET=your_webhook_secret

Troubleshooting Configuration
-----------------------------

Common Issues
~~~~~~~~~~~~~

**Invalid encryption key:**

.. code-block:: bash

   # Ensure key is base64 encoded
   python -c "import base64; print(base64.b64encode(b'your-32-byte-key-here').decode())"

**Model path errors:**

.. code-block:: bash

   # Check if model files exist
   ls -la src/infrastructure/yolo/client/best.pt
   ls -la src/infrastructure/osnet/client/

**GPU not detected:**

.. code-block:: bash

   # Verify CUDA installation
   python -c "import torch; print(torch.cuda.is_available())"

Validation
~~~~~~~~~~

Validate your configuration:

.. code-block:: python

   from config import YOLOSettings, OSNetSettings, KeySetting

   # Test configuration loading
   yolo_config = YOLOSettings()
   osnet_config = OSNetSettings()
   key_config = KeySetting()

   print("Configuration loaded successfully!")
