

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Training Guide &mdash; watchme 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Inference Guide" href="inference.html" />
    <link rel="prev" title="Configuration Guide" href="../usage/configuration.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            watchme
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/about.html">About WatchMe</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/about.html#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../intro/about.html#system-components">System Components</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../intro/about.html#watchme-ai-backend-features">WatchMe AI Backend Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../intro/about.html#person-re-identification">Person Re-identification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/about.html#object-detection">Object Detection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/about.html#security-performance">Security &amp; Performance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../intro/about.html#watchme-api-features">WatchMe API Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../intro/about.html#authentication-security">Authentication &amp; Security</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/about.html#user-management">User Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/about.html#person-video-management">Person &amp; Video Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/about.html#data-persistence">Data Persistence</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../intro/about.html#watchme-ui-features">WatchMe UI Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../intro/about.html#user-interface">User Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/about.html#file-management">File Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/about.html#user-experience">User Experience</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/about.html#visualization">Visualization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../intro/about.html#system-architecture">System Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../intro/about.html#data-flow">Data Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/about.html#integration-points">Integration Points</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../intro/about.html#getting-started">Getting Started</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../intro/requeriments.html">Requirements</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/requeriments.html#system-overview">System Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/requeriments.html#watchme-ai-backend-requirements">WatchMe AI Backend Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../intro/requeriments.html#core-dependencies">Core Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/requeriments.html#system-dependencies">System Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/requeriments.html#optional-gpu-support">Optional GPU Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../intro/requeriments.html#related-components-optional">Related Components (Optional)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../intro/requeriments.html#watchme-node-js-api">WatchMe Node.js API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/requeriments.html#watchme-frontend">WatchMe Frontend</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../intro/requeriments.html#verification">Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/requeriments.html#next-steps">Next Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/requeriments.html#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/quickstart.html">Quick Start Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage/quickstart.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/quickstart.html#step-1-start-the-server">Step 1: Start the Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/quickstart.html#step-2-test-the-api">Step 2: Test the API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/quickstart.html#upload-a-reference-image">Upload a Reference Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/quickstart.html#search-in-a-video">Search in a Video</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/quickstart.html#step-3-websocket-connection">Step 3: WebSocket Connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/quickstart.html#what-s-next">What’s Next?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usage/configuration.html">Configuration Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage/configuration.html#environment-variables">Environment Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/configuration.html#core-configuration">Core Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/configuration.html#model-configuration">Model Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/configuration.html#performance-settings">Performance Settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/configuration.html#generating-encryption-key">Generating Encryption Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/configuration.html#deployment-configuration">Deployment Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/configuration.html#development-environment">Development Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/configuration.html#production-environment">Production Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/configuration.html#docker-configuration">Docker Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/configuration.html#logging-configuration">Logging Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/configuration.html#advanced-configuration">Advanced Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/configuration.html#custom-model-paths">Custom Model Paths</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/configuration.html#troubleshooting-configuration">Troubleshooting Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/configuration.html#common-issues">Common Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/configuration.html#validation">Validation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Training Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#yolo-training">YOLO Training</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dataset-preparation">Dataset Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#training-configuration">Training Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resume-training">Resume Training</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hyperparameter-tuning">Hyperparameter Tuning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#osnet-training">OSNet Training</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Dataset Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Training Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#model-evaluation">Model Evaluation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#yolo-evaluation">YOLO Evaluation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#osnet-evaluation">OSNet Evaluation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-quality">Data Quality</a></li>
<li class="toctree-l3"><a class="reference internal" href="#training-tips">Training Tips</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hardware-optimization">Hardware Optimization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="inference.html">Inference Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="inference.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="inference.html#yolo-inference">YOLO Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="inference.html#single-image-detection">Single Image Detection</a></li>
<li class="toctree-l3"><a class="reference internal" href="inference.html#batch-image-processing">Batch Image Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="inference.html#video-processing">Video Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="inference.html#real-time-webcam-detection">Real-time Webcam Detection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="inference.html#osnet-inference">OSNet Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="inference.html#single-image-embedding">Single Image Embedding</a></li>
<li class="toctree-l3"><a class="reference internal" href="inference.html#batch-embedding-generation">Batch Embedding Generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="inference.html#person-gallery-creation">Person Gallery Creation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="inference.html#combined-pipeline">Combined Pipeline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="inference.html#complete-person-search">Complete Person Search</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api-endpoints.html">API Endpoints Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api-endpoints.html#base-url">Base URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="api-endpoints.html#authentication">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="api-endpoints.html#content-types">Content Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="api-endpoints.html#core-endpoints">Core Endpoints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api-endpoints.html#upload-person-embedding">Upload Person Embedding</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-endpoints.html#find-person-in-video">Find Person in Video</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api-endpoints.html#websocket-endpoints">WebSocket Endpoints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api-endpoints.html#real-time-video-stream-processing">Real-time Video Stream Processing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api-endpoints.html#error-handling">Error Handling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api-endpoints.html#http-status-codes">HTTP Status Codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-endpoints.html#error-response-format">Error Response Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-endpoints.html#common-errors">Common Errors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api-endpoints.html#rate-limiting">Rate Limiting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api-endpoints.html#websocket-connections">WebSocket Connections</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-endpoints.html#http-endpoints">HTTP Endpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-endpoints.html#request-limits">Request Limits</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api-endpoints.html#integration-examples">Integration Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api-endpoints.html#python-client">Python Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-endpoints.html#node-js-typescript-client">Node.js/TypeScript Client</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api-endpoints.html#testing">Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api-endpoints.html#health-check">Health Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-endpoints.html#api-documentation">API Documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api-endpoints.html#performance-considerations">Performance Considerations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api-endpoints.html#optimization-tips">Optimization Tips</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-endpoints.html#monitoring">Monitoring</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/video-search.html">Video Search Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/video-search.html#basic-video-search">Basic Video Search</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/video-search.html#upload-reference-image-and-search-video">Upload Reference Image and Search Video</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/video-search.html#complete-python-example">Complete Python Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/websocket.html">WebSocket Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/websocket.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/websocket.html#connection-setup">Connection Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/websocket.html#basic-websocket-connection">Basic WebSocket Connection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/websocket.html#message-types">Message Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/websocket.html#client-to-server-messages">Client to Server Messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/websocket.html#server-to-client-messages">Server to Client Messages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/websocket.html#complete-examples">Complete Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/websocket.html#real-time-webcam-tracking">Real-time Webcam Tracking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/websocket.html#python-async-example">Python Async Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/websocket.html#error-handling-and-reconnection">Error Handling and Reconnection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/websocket.html#robust-websocket-implementation">Robust WebSocket Implementation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/websocket.html#performance-optimization">Performance Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/websocket.html#frame-rate-control">Frame Rate Control</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/websocket.html#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/websocket.html#security-considerations">Security Considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/websocket.html#resource-management">Resource Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/websocket.html#monitoring-and-debugging">Monitoring and Debugging</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">watchme</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Training Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guide/training.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="training-guide">
<h1>Training Guide<a class="headerlink" href="#training-guide" title="Link to this heading"></a></h1>
<p>This guide covers training custom models for both YOLO object detection and OSNet person re-identification in the WatchMe AI Backend system.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The WatchMe AI Backend supports training of two main model types:</p>
<ul class="simple">
<li><p><strong>YOLO Models</strong>: For person detection and bounding box extraction</p></li>
<li><p><strong>OSNet Models</strong>: For person re-identification and embedding generation</p></li>
</ul>
<p>Each model type requires specific dataset formats and training configurations.</p>
</section>
<section id="yolo-training">
<h2>YOLO Training<a class="headerlink" href="#yolo-training" title="Link to this heading"></a></h2>
<section id="dataset-preparation">
<h3>Dataset Preparation<a class="headerlink" href="#dataset-preparation" title="Link to this heading"></a></h3>
<p><strong>Dataset Structure:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>src/dataset/yolo/
├── images/
│   ├── train/
│   │   ├── image1.jpg
│   │   ├── image2.jpg
│   │   └── ...
│   ├── val/
│   │   ├── image1.jpg
│   │   ├── image2.jpg
│   │   └── ...
│   └── test/
│       ├── image1.jpg
│       ├── image2.jpg
│       └── ...
└── labels/
    ├── train/
    │   ├── image1.txt
    │   ├── image2.txt
    │   └── ...
    ├── val/
    │   ├── image1.txt
    │   ├── image2.txt
    │   └── ...
    └── test/
        ├── image1.txt
        ├── image2.txt
        └── ...
</pre></div>
</div>
<p><strong>Label Format (YOLO format):</strong></p>
<p>Each <cite>.txt</cite> file contains one line per object:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>class_id center_x center_y width height
</pre></div>
</div>
<p>Where coordinates are normalized (0-1):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>0 0.5 0.5 0.3 0.8
</pre></div>
</div>
<p>Example for person detection (class 0 = person):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>0 0.456 0.392 0.123 0.654
0 0.789 0.123 0.087 0.456
</pre></div>
</div>
<p><strong>Configuration File (`dataset.yaml`):</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># filepath: src/dataset/yolo/dataset.yaml</span>
<span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src/dataset/yolo</span>
<span class="nt">train</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">images/train</span>
<span class="nt">val</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">images/val</span>
<span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">images/test</span>

<span class="nt">nc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># number of classes</span>
<span class="nt">names</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;person&#39;</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># class names</span>
</pre></div>
</div>
<p>You can use the script <code class="docutils literal notranslate"><span class="pre">annotation_to_txt.py</span></code> to turn a JSON annotation file into a list of .txt</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">coco_json</span> <span class="o">=</span> <span class="s2">&quot;src/dataset/yolo/labels/instances_val2017.json&quot;</span> <span class="c1">#JSON file path</span>
<span class="n">images_dir</span> <span class="o">=</span> <span class="s2">&quot;src/dataset/yolo/images/val&quot;</span> <span class="c1">#Images directory (can be either val/train/test)</span>
<span class="n">labels_dir</span> <span class="o">=</span> <span class="s2">&quot;src/dataset/yolo/labels/val&quot;</span> <span class="c1">#Labels directory (can be either val/train/test)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">labels_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">coco_json</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">coco</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">images</span> <span class="o">=</span> <span class="p">{</span><span class="n">img</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]:</span> <span class="n">img</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">coco</span><span class="p">[</span><span class="s2">&quot;images&quot;</span><span class="p">]}</span>

<span class="n">PERSON_CLASS_ID</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">ann</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">coco</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">],</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Converting&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ann</span><span class="p">[</span><span class="s2">&quot;category_id&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">PERSON_CLASS_ID</span><span class="p">:</span>
        <span class="k">continue</span>

    <span class="n">img_info</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="n">ann</span><span class="p">[</span><span class="s2">&quot;image_id&quot;</span><span class="p">]]</span>
    <span class="n">img_w</span><span class="p">,</span> <span class="n">img_h</span> <span class="o">=</span> <span class="n">img_info</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span> <span class="n">img_info</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">ann</span><span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">]</span>
    <span class="n">x_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">img_w</span>
    <span class="n">y_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">img_h</span>
    <span class="n">w</span> <span class="o">/=</span> <span class="n">img_w</span>
    <span class="n">h</span> <span class="o">/=</span> <span class="n">img_h</span>

    <span class="n">txt_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">img_info</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span>
    <span class="n">txt_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">labels_dir</span><span class="p">,</span> <span class="n">txt_name</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">txt_path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_out</span><span class="p">:</span>
        <span class="n">f_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;0 </span><span class="si">{</span><span class="n">x_center</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_center</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">w</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="training-configuration">
<h3>Training Configuration<a class="headerlink" href="#training-configuration" title="Link to this heading"></a></h3>
<p><strong>Environment Variables:</strong></p>
<p>This repository comes with a trained model in src/infrastructure/yolo/client/best.pt</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># .env.yolo</span>
<span class="nv">YOLO_MODEL_PATH</span><span class="o">=</span>yolov11n.pt<span class="w">  </span><span class="c1"># Base model (You can use best.pt)</span>
<span class="nv">YOLO_BATCH_SIZE</span><span class="o">=</span><span class="m">16</span>
<span class="nv">YOLO_LEARNING_RATE</span><span class="o">=</span><span class="m">0</span>.001
<span class="nv">YOLO_LOSS_FUNC</span><span class="o">=</span>AdamW
<span class="nv">YOLO_DROPOUT</span><span class="o">=</span><span class="m">0</span>.0
<span class="nv">YOLO_DEVICE</span><span class="o">=</span><span class="m">0</span>
<span class="nv">YOLO_DATASET_PATH</span><span class="o">=</span>src/dataset/yolo/dataset.yml
<span class="nv">YOLO_PROJECT_PATH</span><span class="o">=</span>src/dataset/yolo/runs/detect
</pre></div>
</div>
<p><strong>Training Script:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># python -m src.infrastructure.yolo.core.train</span>

 <span class="k">class</span><span class="w"> </span><span class="nc">YOLOTrainer</span><span class="p">:</span>
<span class="w">     </span><span class="sd">&quot;&quot;&quot;Handle YOLO training operations&quot;&quot;&quot;</span>

     <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">YOLOSettings</span><span class="p">()</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="kc">None</span>

     <span class="k">def</span><span class="w"> </span><span class="nf">load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">         </span><span class="sd">&quot;&quot;&quot;Load YOLO model&quot;&quot;&quot;</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">yolo_client</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="c1">#You can just call an YOLO object</span>
         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Model loaded: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;baseline_weights&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown path&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

     <span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hyperparams</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">         </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Trains the YOLO model using the specified weights and hyperparameters.</span>
<span class="sd">         Args:</span>
<span class="sd">             weights (str or None): Path to the pretrained weights file. If None, uses default weights.</span>
<span class="sd">             hyperparams (dict or None): Dictionary of hyperparameters to override defaults. Supported keys include:</span>
<span class="sd">                 - &quot;box&quot; (int): Box loss gain.</span>
<span class="sd">                 - &quot;cls&quot; (float): Class loss gain.</span>
<span class="sd">                 - &quot;lr0&quot; (float): Initial learning rate.</span>
<span class="sd">                 - &quot;dropout&quot; (float): Dropout rate.</span>
<span class="sd">         Raises:</span>
<span class="sd">             ValueError: If the YOLO model fails to load or does not have a &#39;train&#39; method.</span>
<span class="sd">         Returns:</span>
<span class="sd">             Any: Training results returned by the YOLO model&#39;s train method.</span>
<span class="sd">         &quot;&quot;&quot;</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">):</span>
             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Failed to load YOLO model or &#39;train&#39; method not found.&quot;</span><span class="p">)</span>

         <span class="n">hp</span> <span class="o">=</span> <span class="n">hyperparams</span> <span class="k">if</span> <span class="n">hyperparams</span> <span class="k">else</span> <span class="p">{}</span>
         <span class="n">box</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;box&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
         <span class="bp">cls</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cls&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
         <span class="n">lr0</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lr0&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">YOLO_LEARNING_RATE</span><span class="p">)</span>
         <span class="n">dropout</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dropout&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">YOLO_DROPOUT</span><span class="p">)</span>

         <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
             <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">YOLO_DATASET_PATH</span><span class="p">,</span>
             <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">YOLO_PROJECT_PATH</span><span class="p">,</span>
             <span class="n">name</span><span class="o">=</span><span class="s2">&quot;baseline_train&quot;</span><span class="p">,</span>
             <span class="n">multi_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">amp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">freeze</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
             <span class="n">box</span><span class="o">=</span><span class="n">box</span><span class="p">,</span>
             <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span>
             <span class="n">epochs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">YOLO_EPOCHS</span><span class="p">,</span>
             <span class="n">batch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">YOLO_BATCH_SIZE</span><span class="p">,</span>
             <span class="n">optimizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">YOLO_LOSS_FUNC</span><span class="p">,</span>
             <span class="n">lr0</span><span class="o">=</span><span class="n">lr0</span><span class="p">,</span>
             <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
             <span class="n">imgsz</span><span class="o">=</span><span class="mi">640</span><span class="p">,</span>
             <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">YOLO_DEVICE</span><span class="p">,</span>
         <span class="p">)</span>

         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span>

     <span class="k">def</span><span class="w"> </span><span class="nf">get_best_weights_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">         </span><span class="sd">&quot;&quot;&quot;Get path to best weights from last training&quot;&quot;&quot;</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No training results available. Train model first.&quot;</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">save_dir</span><span class="p">),</span> <span class="s2">&quot;weights&quot;</span><span class="p">,</span> <span class="s2">&quot;best.pt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Advanced Training Options:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="s2">&quot;src/dataset/yolo/dataset.yaml&quot;</span><span class="p">,</span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">batch</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
    <span class="n">imgsz</span><span class="o">=</span><span class="mi">640</span><span class="p">,</span>
    <span class="n">project</span><span class="o">=</span><span class="s2">&quot;src/infrastructure/yolo/projects&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;advanced_person_detection&quot;</span><span class="p">,</span>

    <span class="c1"># Advanced parameters</span>
    <span class="n">patience</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>           <span class="c1"># Early stopping patience</span>
    <span class="n">save_period</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>        <span class="c1"># Save checkpoint every N epochs</span>
    <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>           <span class="c1"># Cache images for faster training</span>
    <span class="n">device</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span>           <span class="c1"># GPU device</span>
    <span class="n">workers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>            <span class="c1"># Number of dataloader workers</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;AdamW&#39;</span><span class="p">,</span>    <span class="c1"># Optimizer choice</span>
    <span class="n">lr0</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>            <span class="c1"># Initial learning rate</span>
    <span class="n">lrf</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>            <span class="c1"># Final learning rate</span>
    <span class="n">momentum</span><span class="o">=</span><span class="mf">0.937</span><span class="p">,</span>       <span class="c1"># SGD momentum</span>
    <span class="n">weight_decay</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">,</span>  <span class="c1"># Optimizer weight decay</span>
    <span class="n">warmup_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>      <span class="c1"># Warmup epochs</span>
    <span class="n">warmup_momentum</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>  <span class="c1"># Warmup initial momentum</span>
    <span class="n">box</span><span class="o">=</span><span class="mf">7.5</span><span class="p">,</span>             <span class="c1"># Box loss gain</span>
    <span class="bp">cls</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>             <span class="c1"># Classification loss gain</span>
    <span class="n">dfl</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>             <span class="c1"># Distribution focal loss gain</span>

    <span class="c1"># Augmentation</span>
    <span class="n">hsv_h</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span>         <span class="c1"># Image HSV-Hue augmentation</span>
    <span class="n">hsv_s</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>           <span class="c1"># Image HSV-Saturation augmentation</span>
    <span class="n">hsv_v</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>           <span class="c1"># Image HSV-Value augmentation</span>
    <span class="n">degrees</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>         <span class="c1"># Image rotation (+/- deg)</span>
    <span class="n">translate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>       <span class="c1"># Image translation (+/- fraction)</span>
    <span class="n">scale</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>           <span class="c1"># Image scale (+/- gain)</span>
    <span class="n">shear</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>           <span class="c1"># Image shear (+/- deg)</span>
    <span class="n">perspective</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>     <span class="c1"># Image perspective (+/- fraction)</span>
    <span class="n">flipud</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>          <span class="c1"># Image flip up-down (probability)</span>
    <span class="n">fliplr</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>          <span class="c1"># Image flip left-right (probability)</span>
    <span class="n">mosaic</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>          <span class="c1"># Image mosaic (probability)</span>
    <span class="n">mixup</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>           <span class="c1"># Image mixup (probability)</span>
    <span class="n">copy_paste</span><span class="o">=</span><span class="mf">0.0</span>       <span class="c1"># Segment copy-paste (probability)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="resume-training">
<h3>Resume Training<a class="headerlink" href="#resume-training" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resume from checkpoint</span>
<span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">resume</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Resume from last checkpoint</span>
    <span class="c1"># or specify specific checkpoint:</span>
    <span class="c1"># resume=&quot;src/infrastructure/yolo/projects/person_detection/weights/last.pt&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="hyperparameter-tuning">
<h3>Hyperparameter Tuning<a class="headerlink" href="#hyperparameter-tuning" title="Link to this heading"></a></h3>
<p><strong>Using Ray Tune:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># python -m src.infrastructure.yolo.core.tune</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HyperparameterTuner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle hyperparameter tuning with Ray Tune (with resume support)&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">YOLOSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_search_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define hyperparameter search space for YOLO training&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;lr0&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">),</span>
            <span class="s2">&quot;momentum&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">),</span>
            <span class="s2">&quot;box&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
            <span class="s2">&quot;cls&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>
            <span class="s2">&quot;hsv_s&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
            <span class="s2">&quot;hsv_v&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
            <span class="s2">&quot;degrees&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">),</span>
            <span class="s2">&quot;translate&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
            <span class="s2">&quot;shear&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span>
            <span class="s2">&quot;dropout&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_for_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if there&#39;s an existing ray_tune checkpoint to resume from&quot;&quot;&quot;</span>
        <span class="n">ray_tune_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">YOLO_PROJECT_PATH</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;ray_tune&quot;</span>
        <span class="k">if</span> <span class="n">ray_tune_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">ray_tune_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">tune</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseline_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tune hyperparameters using Ray Tune with resume support</span>

<span class="sd">        Args:</span>
<span class="sd">            baseline_weights (str, optional): Path to baseline weights file (.pt)</span>
<span class="sd">            iterations (int): Number of tuning trials to run</span>
<span class="sd">            epochs (int): Number of epochs per trial</span>

<span class="sd">        Returns:</span>
<span class="sd">            ray.tune.ExperimentAnalysis: Results object containing best hyperparameters</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If Ray Tune encounters an error</span>
<span class="sd">            TuneError: If there&#39;s an issue with the tuning process</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ray</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">():</span>
                <span class="n">ray</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

            <span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
                <span class="n">ignore_reinit_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">num_cpus</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                <span class="n">num_gpus</span><span class="o">=</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">YOLO_DEVICE</span> <span class="o">!=</span> <span class="s2">&quot;cpu&quot;</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">yolo_client</span><span class="p">(</span><span class="n">baseline_weights</span><span class="p">)</span>
            <span class="n">resume_checkpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_checkpoint</span><span class="p">()</span>
            <span class="n">search_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_search_space</span><span class="p">()</span>

            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">YOLO_DATASET_PATH</span><span class="p">,</span>
                <span class="n">use_ray</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">space</span><span class="o">=</span><span class="n">search_space</span><span class="p">,</span>
                <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
                <span class="n">iterations</span><span class="o">=</span><span class="n">iterations</span><span class="p">,</span>
                <span class="n">grace_period</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">gpu_per_trial</span><span class="o">=</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">YOLO_DEVICE</span> <span class="o">!=</span> <span class="s1">&#39;cpu&#39;</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">YOLO_PROJECT_PATH</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ray_tune&quot;</span><span class="p">,</span>
                <span class="n">resume</span><span class="o">=</span><span class="n">resume_checkpoint</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">best_params</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_results</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">results</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">TuneError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during model tuning: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ray</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">():</span>
                <span class="n">ray</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_best_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the best hyperparameters from the last tuning run&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_params</span>
</pre></div>
</div>
<p><strong>Tune/Training Pipeline:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># python -m src.infrastructure.yolo.pipeline</span>
<span class="k">class</span><span class="w"> </span><span class="nc">YOLOPipeline</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete YOLO training pipeline with resume support&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">YOLOSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span> <span class="o">=</span> <span class="n">YOLOTrainer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuner</span> <span class="o">=</span> <span class="n">HyperparameterTuner</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_weights</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_hyperparams</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_results</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_for_baseline_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if there&#39;s an existing baseline weights to resume from&quot;&quot;&quot;</span>
        <span class="n">baseline_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">YOLO_PROJECT_PATH</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;baseline_train&quot;</span>
        <span class="n">best_weights_path</span> <span class="o">=</span> <span class="n">baseline_dir</span> <span class="o">/</span> <span class="s2">&quot;weights&quot;</span> <span class="o">/</span> <span class="s2">&quot;best.pt&quot;</span>

        <span class="n">model_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">YOLO_MODEL_PATH</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">best_weights_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">best_weights_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">model_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run complete pipeline: baseline training -&gt; tuning -&gt; final training</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;YOLO Training &amp; Hyperparameter Tuning Pipeline&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

        <span class="n">has_baseline</span><span class="p">,</span> <span class="n">baseline_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_baseline_weights</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_baseline</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[1/3] Training baseline model...&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

            <span class="n">baseline_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">baseline_results</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">baseline_results</span><span class="p">,</span> <span class="s1">&#39;save_dir&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">baseline_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">get_best_weights_path</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Baseline training completed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_weights</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Training failed or returned invalid results&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[1/3] Found existing baseline weights: </span><span class="si">{</span><span class="n">baseline_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baseline_weights</span> <span class="o">=</span> <span class="n">baseline_path</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[2/3] Running hyperparameter tuning...&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">tune_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuner</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span>
            <span class="n">baseline_weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_weights</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">best_hyperparams</span> <span class="o">=</span> <span class="n">tune_results</span><span class="o">.</span><span class="n">get_best_result</span><span class="p">()</span><span class="o">.</span><span class="n">config</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Best hyperparameters found: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">best_hyperparams</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[3/3] Final training with optimized hyperparameters...&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
            <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_weights</span><span class="p">,</span>
            <span class="n">hyperparams</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">best_hyperparams</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pipeline completed successfully!&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Baseline weights: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_weights</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final model: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">final_results</span><span class="o">.</span><span class="n">save_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_results</span>
</pre></div>
</div>
</section>
</section>
<section id="osnet-training">
<h2>OSNet Training<a class="headerlink" href="#osnet-training" title="Link to this heading"></a></h2>
<section id="id1">
<h3>Dataset Preparation<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p><strong>Dataset Structure (Market-1501 format):</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>src/dataset/osnet/dukemtmc-vidreid/
├── tracklet_train/
│   ├── 0001/
│   │   ├── 0001_c1s1_000151_01.jpg
│   │   └── ...
│   └── ...
├── tracklet_test/
│   ├── 0001/
│   │   ├── 0001_c2s1_001976_01.jpg
│   │   └── ...
│   └── ...
├── query/
│   ├── 0001/
│   │   ├── 0001_c1s1_001051_00.jpg
│   │   └── ...
│   └── ...
</pre></div>
</div>
<p><strong>Filename Convention:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{person_id}_{camera_id}s{sequence_id}_{frame_number}_{additional_id}.jpg

Examples:
0001_c1s1_000151_01.jpg  # Person 1, Camera 1, Sequence 1, Frame 151
0042_c3s2_001234_02.jpg  # Person 42, Camera 3, Sequence 2, Frame 1234
</pre></div>
</div>
<p><strong>Data Split Configuration:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># src/infrastructure/osnet/core/train.py</span>

 <span class="n">data_config</span> <span class="o">=</span> <span class="p">{</span>
     <span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="s1">&#39;src/dataset/osnet&#39;</span><span class="p">,</span>
     <span class="s1">&#39;sources&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;dukemtmcvidreid&#39;</span><span class="p">],</span>  <span class="c1"># Use the correct dataset name</span>
     <span class="s1">&#39;targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;dukemtmcvidreid&#39;</span><span class="p">],</span>
     <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
     <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
     <span class="s1">&#39;combineall&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
     <span class="s1">&#39;transforms&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;random_flip&#39;</span><span class="p">,</span> <span class="s1">&#39;random_crop&#39;</span><span class="p">,</span> <span class="s1">&#39;normalize&#39;</span><span class="p">],</span>
     <span class="s1">&#39;k_tfm&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="s1">&#39;load_train_targets&#39;</span><span class="p">:</span> <span class="kc">False</span>
 <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>Training Configuration<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p><strong>Environment Variables:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># .env.osnet</span>
<span class="nv">OSNET_EPOCHS</span><span class="o">=</span><span class="m">250</span>
<span class="nv">OSNET_LEARNING_RATE</span><span class="o">=</span><span class="m">0</span>.0003
<span class="nv">OSNET_WEIGHT_DECAY</span><span class="o">=</span><span class="m">0</span>.0005
<span class="nv">OSNET_BATCH_SIZE</span><span class="o">=</span><span class="m">32</span>
<span class="nv">OSNET_OPTIMIZER</span><span class="o">=</span>adam
<span class="nv">OSNET_NUM_CLASSES</span><span class="o">=</span><span class="m">751</span><span class="w">        </span><span class="c1"># Number of unique person IDs</span>
<span class="nv">OSNET_IMG_HEIGHT</span><span class="o">=</span><span class="m">256</span>
<span class="nv">OSNET_IMG_WIDTH</span><span class="o">=</span><span class="m">128</span>
<span class="nv">OSNET_NUM_INSTANCES</span><span class="o">=</span><span class="m">4</span>
<span class="nv">OSNET_MARGIN</span><span class="o">=</span><span class="m">0</span>.3
<span class="nv">OSNET_STEPSIZE</span><span class="o">=</span><span class="m">20</span>
<span class="nv">OSNET_EVAL_FREQ</span><span class="o">=</span><span class="m">30</span>
<span class="nv">OSNET_PRINT_FREQ</span><span class="o">=</span><span class="m">10</span>
<span class="nv">OSNET_DATASET_NAME</span><span class="o">=</span>dukemtmcvidreid
<span class="nv">OSNET_ROOT_DIR</span><span class="o">=</span>src/dataset/osnet
<span class="nv">OSNET_SAVE_DIR</span><span class="o">=</span>src/infrastructure/osnet/client
<span class="nv">OSNET_MODEL_NAME</span><span class="o">=</span>model.pth.tar
</pre></div>
</div>
<p><strong>Training Script:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># python -m src.infrastructure.osnet.core.train</span>

 <span class="k">class</span><span class="w"> </span><span class="nc">OSNetTrainer</span><span class="p">:</span>
<span class="w">     </span><span class="sd">&quot;&quot;&quot;Handle OSNet training operations.&quot;&quot;&quot;</span>

     <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">OSNetSettings</span><span class="p">()</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">osnet_client</span> <span class="o">=</span> <span class="n">OSNetModel</span><span class="p">()</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">datamanager</span> <span class="o">=</span> <span class="kc">None</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_components</span><span class="p">()</span>

     <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">         </span><span class="sd">&quot;&quot;&quot;Initialize datamanager and model.&quot;&quot;&quot;</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">datamanager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">osnet_client</span><span class="o">.</span><span class="n">create_datamanager</span><span class="p">()</span>
         <span class="n">num_train_pids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamanager</span><span class="o">.</span><span class="n">num_train_pids</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">osnet_client</span><span class="o">.</span><span class="n">create_osnet_model</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="n">num_train_pids</span><span class="p">)</span>

     <span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">         </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Train OSNet model with optional hyperparameters.</span>

<span class="sd">         Args:</span>
<span class="sd">             weights: Path to pre-trained weights/checkpoint (optional)</span>
<span class="sd">             hp: Dictionary of hyperparameters (optional)</span>

<span class="sd">         Returns:</span>
<span class="sd">             results: Training results with metrics</span>
<span class="sd">         &quot;&quot;&quot;</span>
         <span class="n">max_epoch</span> <span class="o">=</span> <span class="p">(</span>
             <span class="n">hp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_epoch&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_EPOCHS</span><span class="p">)</span>
             <span class="k">if</span> <span class="n">hp</span>
             <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_EPOCHS</span>
         <span class="p">)</span>
         <span class="n">lr</span> <span class="o">=</span> <span class="p">(</span>
             <span class="n">hp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lr&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_LEARNING_RATE</span><span class="p">)</span>
             <span class="k">if</span> <span class="n">hp</span>
             <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_LEARNING_RATE</span>
         <span class="p">)</span>
         <span class="n">weight_decay</span> <span class="o">=</span> <span class="p">(</span>
             <span class="n">hp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weight_decay&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_WEIGHT_DECAY</span><span class="p">)</span>
             <span class="k">if</span> <span class="n">hp</span>
             <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_WEIGHT_DECAY</span>
         <span class="p">)</span>
         <span class="n">optimizer_name</span> <span class="o">=</span> <span class="p">(</span>
             <span class="n">hp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;optimizer&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_OPTIMIZER</span><span class="p">)</span>
             <span class="k">if</span> <span class="n">hp</span>
             <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_OPTIMIZER</span>
         <span class="p">)</span>

         <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torchreid</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">build_optimizer</span><span class="p">(</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">optim</span><span class="o">=</span><span class="n">optimizer_name</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span>
         <span class="p">)</span>

         <span class="n">scheduler</span> <span class="o">=</span> <span class="n">torchreid</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">build_lr_scheduler</span><span class="p">(</span>
             <span class="n">optimizer</span><span class="p">,</span>
             <span class="n">lr_scheduler</span><span class="o">=</span><span class="s2">&quot;single_step&quot;</span><span class="p">,</span>
             <span class="n">stepsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_STEPSIZE</span><span class="p">,</span>
         <span class="p">)</span>

         <span class="n">start_epoch</span> <span class="o">=</span> <span class="mi">0</span>
         <span class="k">if</span> <span class="n">weights</span> <span class="ow">and</span> <span class="n">Path</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resuming from checkpoint: </span><span class="si">{</span><span class="n">weights</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
             <span class="n">start_epoch</span> <span class="o">=</span> <span class="n">torchreid</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">resume_from_checkpoint</span><span class="p">(</span>
                 <span class="n">weights</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span>
             <span class="p">)</span>
         <span class="k">elif</span> <span class="n">weights</span><span class="p">:</span>
             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Checkpoint not found at </span><span class="si">{</span><span class="n">weights</span><span class="si">}</span><span class="s2">, starting from scratch&quot;</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
             <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No checkpoint provided, starting from scratch&quot;</span><span class="p">)</span>

         <span class="n">engine</span> <span class="o">=</span> <span class="n">torchreid</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">VideoTripletEngine</span><span class="p">(</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">datamanager</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
             <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
             <span class="n">scheduler</span><span class="o">=</span><span class="n">scheduler</span><span class="p">,</span>
             <span class="n">label_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">margin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_MARGIN</span><span class="p">,</span>
         <span class="p">)</span>

         <span class="n">engine</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
             <span class="n">save_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_SAVE_DIR</span><span class="p">,</span>
             <span class="n">max_epoch</span><span class="o">=</span><span class="n">max_epoch</span><span class="p">,</span>
             <span class="n">start_epoch</span><span class="o">=</span><span class="n">start_epoch</span><span class="p">,</span>
             <span class="n">start_eval</span><span class="o">=</span><span class="n">max_epoch</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
             <span class="n">eval_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_EVAL_FREQ</span><span class="p">,</span>
             <span class="n">print_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_PRINT_FREQ</span><span class="p">,</span>
             <span class="n">test_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="p">)</span>

         <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
             <span class="s2">&quot;save_dir&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_SAVE_DIR</span><span class="p">,</span>
             <span class="s2">&quot;final_epoch&quot;</span><span class="p">:</span> <span class="n">max_epoch</span><span class="p">,</span>
         <span class="p">}</span>

         <span class="k">return</span> <span class="n">results</span>

     <span class="k">def</span><span class="w"> </span><span class="nf">get_best_model_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">         </span><span class="sd">&quot;&quot;&quot;Get path to the best saved model.&quot;&quot;&quot;</span>
         <span class="n">save_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_SAVE_DIR</span><span class="p">)</span>
         <span class="n">model_path</span> <span class="o">=</span> <span class="n">save_dir</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">OSNET_MODEL_NAME</span>
         <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">model_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
</pre></div>
</div>
<p><strong>Advanced Training Configuration:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Advanced OSNet training with custom settings</span>

<span class="k">def</span><span class="w"> </span><span class="nf">advanced_training</span><span class="p">():</span>
    <span class="c1"># Data augmentation configuration</span>
    <span class="n">transform_configs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;random_flip&#39;</span><span class="p">,</span>
        <span class="s1">&#39;random_crop&#39;</span><span class="p">,</span>
        <span class="s1">&#39;random_erase&#39;</span><span class="p">,</span>
        <span class="s1">&#39;color_jitter&#39;</span><span class="p">,</span>
        <span class="s1">&#39;random_gray_scale&#39;</span><span class="p">,</span>
        <span class="s1">&#39;normalize&#39;</span>
    <span class="p">]</span>

    <span class="c1"># Multiple dataset sources</span>
    <span class="n">datamanager</span> <span class="o">=</span> <span class="n">torchreid</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">VideoDataManager</span><span class="p">(</span>
        <span class="n">root</span><span class="o">=</span><span class="s1">&#39;src/dataset/osnet&#39;</span><span class="p">,</span>
        <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;market1501&#39;</span><span class="p">,</span> <span class="s1">&#39;dukemtmcreid&#39;</span><span class="p">],</span>  <span class="c1"># Multiple datasets</span>
        <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;market1501&#39;</span><span class="p">,</span> <span class="s1">&#39;dukemtmcreid&#39;</span><span class="p">],</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">batch_size_train</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
        <span class="n">batch_size_test</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">transforms</span><span class="o">=</span><span class="n">transform_configs</span><span class="p">,</span>
        <span class="n">num_instances</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">num_cams</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>              <span class="c1"># Number of cameras per identity</span>
        <span class="n">num_datasets</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>          <span class="c1"># Number of datasets</span>
        <span class="n">combineall</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>         <span class="c1"># Combine all data for training</span>
        <span class="n">load_train_targets</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">k_tfm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">train_sampler</span><span class="o">=</span><span class="s1">&#39;RandomIdentitySampler&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Model with advanced configurations</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">torchreid</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">build_model</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;osnet_ibn_x1_0&#39;</span><span class="p">,</span>   <span class="c1"># OSNet with Instance-Batch Normalization</span>
        <span class="n">num_classes</span><span class="o">=</span><span class="n">datamanager</span><span class="o">.</span><span class="n">num_train_pids</span><span class="p">,</span>
        <span class="n">loss</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;triplet&#39;</span><span class="p">,</span> <span class="s1">&#39;softmax&#39;</span><span class="p">],</span>  <span class="c1"># Combined losses</span>
        <span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">use_gpu</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Advanced optimizer configuration</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torchreid</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">build_optimizer</span><span class="p">(</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="n">optim</span><span class="o">=</span><span class="s1">&#39;adamw&#39;</span><span class="p">,</span>           <span class="c1"># AdamW optimizer</span>
        <span class="n">lr</span><span class="o">=</span><span class="mf">0.00035</span><span class="p">,</span>
        <span class="n">weight_decay</span><span class="o">=</span><span class="mf">5e-4</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">amsgrad</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Learning rate scheduler</span>
    <span class="n">scheduler</span> <span class="o">=</span> <span class="n">torchreid</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">build_lr_scheduler</span><span class="p">(</span>
        <span class="n">optimizer</span><span class="p">,</span>
        <span class="n">lr_scheduler</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span>   <span class="c1"># Cosine annealing</span>
        <span class="n">max_epoch</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span>
        <span class="n">restart_epoch</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
        <span class="n">eta_min</span><span class="o">=</span><span class="mf">1e-7</span>
    <span class="p">)</span>

    <span class="c1"># Training engine with advanced settings</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">torchreid</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">ImageTripletEngine</span><span class="p">(</span>
        <span class="n">datamanager</span><span class="p">,</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
        <span class="n">scheduler</span><span class="o">=</span><span class="n">scheduler</span><span class="p">,</span>
        <span class="n">use_gpu</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">label_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">margin</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>              <span class="c1"># Triplet loss margin</span>
        <span class="n">weight_t</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>            <span class="c1"># Triplet loss weight</span>
        <span class="n">weight_x</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>            <span class="c1"># Softmax loss weight</span>
    <span class="p">)</span>

    <span class="c1"># Training execution</span>
    <span class="n">engine</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="n">save_dir</span><span class="o">=</span><span class="s1">&#39;src/infrastructure/osnet/client&#39;</span><span class="p">,</span>
        <span class="n">max_epoch</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span>
        <span class="n">eval_freq</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>             <span class="c1"># Evaluate every 5 epochs</span>
        <span class="n">print_freq</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>           <span class="c1"># Print every 50 iterations</span>
        <span class="n">test_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">visrank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>            <span class="c1"># Save ranking visualization</span>
        <span class="n">visrank_topk</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>         <span class="c1"># Top-k for visualization</span>
        <span class="n">use_metric_cuhk03</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ranks</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>    <span class="c1"># Rank metrics to compute</span>
        <span class="n">rerank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>            <span class="c1"># Post-processing re-ranking</span>
        <span class="n">save_checkpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>    <span class="c1"># Save regular checkpoints</span>
        <span class="n">resume</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>               <span class="c1"># Resume from checkpoint</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="model-evaluation">
<h2>Model Evaluation<a class="headerlink" href="#model-evaluation" title="Link to this heading"></a></h2>
<section id="yolo-evaluation">
<h3>YOLO Evaluation<a class="headerlink" href="#yolo-evaluation" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.infrastructure.yolo.core.evaluate</span><span class="w"> </span><span class="kn">import</span> <span class="n">YOLOEvaluator</span>

<span class="k">def</span><span class="w"> </span><span class="nf">evaluate_yolo</span><span class="p">():</span>
    <span class="n">evaluator</span> <span class="o">=</span> <span class="n">YOLOEvaluator</span><span class="p">()</span>

    <span class="c1"># Evaluate on test set</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
        <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;src/infrastructure/yolo/projects/person_detection/weights/best.pt&quot;</span><span class="p">,</span>
        <span class="n">data_config</span><span class="o">=</span><span class="s2">&quot;src/dataset/yolo/data.yaml&quot;</span><span class="p">,</span>
        <span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mAP@0.5: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;metrics/mAP50(B)&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mAP@0.5:0.95: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;metrics/mAP50-95(B)&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Precision: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;metrics/precision(B)&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recall: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;metrics/recall(B)&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="osnet-evaluation">
<h3>OSNet Evaluation<a class="headerlink" href="#osnet-evaluation" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">evaluate_osnet</span><span class="p">():</span>
    <span class="c1"># Evaluation is automatically performed during training</span>
    <span class="c1"># Results are saved in the save_dir</span>

    <span class="c1"># Manual evaluation</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">torchreid</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">build_model</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;osnet_x1_0&#39;</span><span class="p">,</span>
        <span class="n">num_classes</span><span class="o">=</span><span class="mi">751</span><span class="p">,</span>
        <span class="n">pretrained</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="c1"># Load trained weights</span>
    <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;src/infrastructure/osnet/client/model.pth.tar&#39;</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;state_dict&#39;</span><span class="p">])</span>

    <span class="c1"># Evaluate</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">torchreid</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">VideoTripletEngine</span><span class="p">(</span>
        <span class="n">datamanager</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">scheduler</span>
    <span class="p">)</span>

    <span class="n">engine</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="n">save_dir</span><span class="o">=</span><span class="s1">&#39;src/infrastructure/osnet/client&#39;</span><span class="p">,</span>
        <span class="n">max_epoch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># No training, just evaluation</span>
        <span class="n">test_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">visrank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ranks</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading"></a></h2>
<section id="data-quality">
<h3>Data Quality<a class="headerlink" href="#data-quality" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Ensure high-quality annotations</strong> for YOLO training</p></li>
<li><p><strong>Maintain consistent identity labeling</strong> for OSNet</p></li>
<li><p><strong>Balance dataset classes</strong> to prevent bias</p></li>
<li><p><strong>Use data augmentation</strong> to improve robustness</p></li>
</ol>
</section>
<section id="training-tips">
<h3>Training Tips<a class="headerlink" href="#training-tips" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Start with pre-trained models</strong> for faster convergence</p></li>
<li><p><strong>Use learning rate scheduling</strong> for better optimization</p></li>
<li><p><strong>Monitor validation metrics</strong> to prevent overfitting</p></li>
<li><p><strong>Save regular checkpoints</strong> to recover from failures</p></li>
</ol>
</section>
<section id="hardware-optimization">
<h3>Hardware Optimization<a class="headerlink" href="#hardware-optimization" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Use mixed precision training</strong> for faster training on modern GPUs</p></li>
<li><p><strong>Increase batch size</strong> with available GPU memory</p></li>
<li><p><strong>Use multiple GPUs</strong> for distributed training when available</p></li>
<li><p><strong>Monitor GPU utilization</strong> to ensure efficient resource usage</p></li>
</ol>
<p>This comprehensive training guide provides everything needed to train custom models for the WatchMe AI Backend system, from basic setups to advanced configurations and optimization techniques.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../usage/configuration.html" class="btn btn-neutral float-left" title="Configuration Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="inference.html" class="btn btn-neutral float-right" title="Inference Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Beatriz Amante.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>